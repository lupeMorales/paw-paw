"use strict";const canvas=document.querySelector(".js-canvas"),game=canvas.getContext("2d"),btnUp=document.querySelector(".item-up"),btnDown=document.querySelector(".item-down"),btnRight=document.querySelector(".item-right"),btnLeft=document.querySelector(".item-left"),life=document.querySelector(".js-life"),timer=document.querySelector(".js-timer"),record=document.querySelector(".js-record"),result=document.querySelector(".js-result"),btnCloseModal=document.querySelector(".js-btn-close"),modal=document.querySelector(".js-modal"),modalWinner=document.querySelector(".js-modal-winner"),modalBlock=document.querySelector(".js-modal-block"),btnYes=document.querySelectorAll(".js-yes"),btnNo=document.querySelectorAll(".js-no");let actualMapLevel,canvasSize,elementSize,timeStart,timeInterval,level=0,totalLifes=3;const recordTime=localStorage.getItem("record_time"),messages={levelUp:"Well done!",gameOver:"GAME OVER!",gameWin:"You Win!!! üèÜ"},playerPosition={x:void 0,y:void 0},lastPlayerPosition={x:void 0,y:void 0},bonePosition={x:void 0,y:void 0};let collisionPositions=[],isWithinTheMargin=!0;function setCanvasSize(){canvasSize=window.innerHeight>window.innerWidth?Math.floor(.7*window.innerWidth):Math.floor(.7*window.innerHeight),canvas.setAttribute("width",canvasSize),canvas.setAttribute("height",canvasSize),elementSize=Math.floor(canvasSize/10-.4),game.font=elementSize+"px Verdana",game.textAlign="end",playerPosition.x=void 0,playerPosition.y=void 0,startGame()}function renderLifes(){const e=Array(totalLifes).fill(emojis.HEART);life.innerHTML="",e.forEach(e=>life.innerHTML+=e)}function showTime(){timer.innerHTML=Date.now()-timeStart}function showRecord(){record.innerHTML=recordTime}function renderMapLevel(e){const X=maps[e].trim().split("\n");actualMapLevel=X.map(e=>e.trim().split("")),collisionPositions=[],clearCanvas(),renderLifes(),result.innerHTML=`Level ${e+1}/${maps.length}`,timeStart||(timeStart=Date.now(),timeInterval=setInterval(showTime,100),showRecord()),actualMapLevel.forEach((e,X)=>{e.forEach((e,n)=>{const t=emojis[e],i=elementSize*(n+1),o=elementSize*(X+1);"O"==e?playerPosition.x||playerPosition.y||(playerPosition.x=i,playerPosition.y=o):"I"==e?(bonePosition.x=i,bonePosition.y=o):"X"==e&&collisionPositions.push({x:i,y:o}),game.fillText(t,i,o)})}),renderPlayerPosition()}function renderPlayerPosition(){game.fillText(emojis.PLAYER,playerPosition.x,playerPosition.y),validateCollisions(),getTheBone()}function clearCanvas(){game.clearRect(0,0,canvasSize,canvasSize)}function renderMessage(e){game.font=elementSize+"px Cherry Bomb One",game.fontWeight="bold",game.fillStyle="#c27434",game.textAlign="center",game.fillText(e,canvasSize/2,canvasSize/2)}function exit(){modal.classList.remove("active"),modalWinner.classList.remove("active"),modalBlock.classList.add("active")}function moveUp(){playerPosition.y-=elementSize,withinTheMargin()?startGame():playerPosition.y+=elementSize}function moveDown(){playerPosition.y+=elementSize,withinTheMargin()?startGame():playerPosition.y-=elementSize}function moveLeft(){playerPosition.x-=elementSize,withinTheMargin()?startGame():playerPosition.x+=elementSize}function moveRight(){playerPosition.x+=elementSize,withinTheMargin()?startGame():playerPosition.x-=elementSize}function moveByKeys(e){"ArrowUp"==e.key?moveUp():"ArrowDown"==e.key?moveDown():"ArrowLeft"==e.key?moveLeft():"ArrowRight"==e.key&&moveRight()}function validateCollisions(){collisionPositions.find(e=>{const X=e.x.toFixed(3)==playerPosition.x.toFixed(3),n=e.y.toFixed(3)==playerPosition.y.toFixed(3);return X&&n})&&(game.fillText(emojis.BOMB_COLLISION,playerPosition.x,playerPosition.y),totalLifes>=1?crashOver():setTimeout(gameOver,1e3))}function getTheBone(){JSON.stringify(bonePosition)===JSON.stringify(playerPosition)&&validateLastLevel(level)}function withinTheMargin(){if(playerPosition.x>=elementSize&&playerPosition.x<=canvasSize&&playerPosition.y>=elementSize&&playerPosition.y<=canvasSize)return!0}function validateLastLevel(e){e<maps.length-1?levelUp():winGame()}function crashOver(){loseLife(),playerPosition.x=void 0,playerPosition.y=void 0,setTimeout(startGame,1e3)}function reset(){playerPosition.x=void 0,playerPosition.y=void 0,level=0,totalLifes=["‚ù§Ô∏è","‚ù§Ô∏è","‚ù§Ô∏è"]}function loseLife(){totalLifes--,renderLifes()}function startGame(){renderMapLevel(level)}function gameOver(){clearCanvas(),renderMessage(messages.gameOver),clearInterval(timeInterval),setTimeout((function(){modal.classList.add("active")}),1500)}function levelUp(){level++,clearCanvas(),result.innerHTML=`Level ${level}/${maps.length}`,renderMessage(messages.levelUp),setTimeout(setCanvasSize,1e3)}function winGame(){const e=Date.now()-timeStart;clearInterval(timeInterval);const X=()=>{clearCanvas();for(let e=1;e<=10;e++)for(let X=1;X<=10;X++)game.fillText(emojis.I,elementSize*e,elementSize*X);renderMessage(messages.gameWin),setInterval((function(){(new JSConfetti).addConfetti({emojis:["ü¶¥","üê∂","‚ú®","üèÜ"],confettiRadius:6,confettiNumber:50})}),1e3);const e=modalWinner.classList.add("active");setTimeout(e,5e3)};recordTime?recordTime>=e?(localStorage.setItem("record_time",e),result.innerHTML="Congratulations! You have broken a NEW RECORD",X()):(result.innerHTML="Sorry! NOT new record",X()):(localStorage.setItem("record_time",e),result.innerHTML="Congratulations! You have broken a NEW RECORD",X())}function reload(){location.reload()}window.addEventListener("load",setCanvasSize),window.addEventListener("resize",setCanvasSize),window.addEventListener("keydown",moveByKeys),btnUp.addEventListener("click",moveUp),btnDown.addEventListener("click",moveDown),btnRight.addEventListener("click",moveRight),btnLeft.addEventListener("click",moveLeft),btnYes.forEach(e=>e.addEventListener("click",reload)),btnNo.forEach(e=>e.addEventListener("click",exit)),window.onclick=function(e){e.target==modal?(modal.style.display="none",modalBlock.style.display="block"):e.target==modalWinner&&(modalWinner.style.display="none")},console.log(">> Ready :)");const emojis={"-":" ",O:"üè†",X:"üå≥",I:"ü¶¥",PLAYER:"üê∂",BOMB_COLLISION:"üí•",GAME_OVER:"üëé",WIN:"üèÜ",HEART:"‚ù§Ô∏è"},maps=[];maps.push("\n    IXXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    OXXXXXXXXX\n  "),maps.push("\n    O--XXXXXXX\n    X--XXXXXXX\n    XX----XXXX\n    X--XX-XXXX\n    X-XXX--XXX\n    X-XXXX-XXX\n    XX--XX--XX\n    XX--XXX-XX\n    XXXX---IXX\n    XXXXXXXXXX\n    "),maps.push("\n    I-----XXXX\n    XXXXX-XXXX\n    XX----XXXX\n    XX-XXXXXXX\n    XX-----XXX\n    XXXXXX-XXX\n    XX-----XXX\n    XX-XXXXXXX\n    XX-----OXX\n    XXXXXXXXXX\n  "),maps.push("\n  O---XXXXXX\n  XXX-XXXXXX\n  XXX-XXXXIX\n  XXX-XXXX-X\n  XXX---XX-X\n  XX--X-XX-X\n  XX--X-XX-X\n  XX--XXXX-X\n  XX-------X\n  XXXXXXXXXX\n"),maps.push("\n  X--------X\n  XXX-XX-X-X\n  XXX-XX-XOX\n  XXX-XX-X-X\n  XXX--X-X-X\n  I---X--X-X\n  XX--X-XX-X\n  XX--X-XX-X\n  XX-------X\n  XXXXXXXXXX\n"),maps.push("\n  X---XXXXXX\n  X-X-XXXX-X\n  --X-XXXXXX\n  -XX-XX-X-X\n  -XX----X-X\n  O--XX--X-X\n  XX-XX-XX-X\n  XX-XX-XX-X\n  XX-XX----X\n  XXXXXXXXIX\n"),maps.push("\n  XXXXXXXXXX\n  XXX------X\n  XXX-XXX-XX\n  ----XXX-XX\n  -XXX--X-XX\n  -X----X-XX\n  -X-XX-X-XX\n  -X-XX-X-XX\n  -X-XX----X\n  IXXXXXXXOX\n"),maps.push("\n  XXXXXXXXXX\n  ---------X\n  -XXXXXXX-X\n  -X---XXX-X\n  -X-X-XXX-X\n  -X-X-IXX-X\n  -X-XXXXX-X\n  -X-XXXXX-X\n  -X-------X\n  OXXXXXXXXX\n");