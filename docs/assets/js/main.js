"use strict";const canvas=document.querySelector(".js-canvas"),game=canvas.getContext("2d"),btnUp=document.querySelector(".item-up"),btnDown=document.querySelector(".item-down"),btnRight=document.querySelector(".item-right"),btnLeft=document.querySelector(".item-left"),life=document.querySelector(".js-life"),timer=document.querySelector(".js-timer"),record=document.querySelector(".js-record"),btnCloseModal=document.querySelector(".js-btn-close"),modal=document.querySelector(".js-modal"),modalWinner=document.querySelector(".js-modal-winner"),modalBlock=document.querySelector(".js-modal-block"),btnNo=document.querySelector(".js-btn-no"),btnNoPlay=document.querySelector(".js-no");let actualMapLevel,canvasSize,elementSize,timeStart,timeInterval,level=0,totalLifes=3;const recordTime=localStorage.getItem("record_time"),messages={levelUp:"Well done!",gameOver:"GAME OVER!",newRecord:"NEW RECORD 🏆",gameWin:"Record not broken"},playerPosition={x:void 0,y:void 0},bonePosition={x:void 0,y:void 0};let collisionPositions=[],isWithinTheMargin=!0;function setCanvasSize(){canvasSize=window.innerHeight>window.innerWidth?Math.floor(.75*window.innerWidth):Math.floor(.75*window.innerHeight),canvas.setAttribute("width",canvasSize),canvas.setAttribute("height",canvasSize),elementSize=Math.floor(canvasSize/10-.4),game.font=elementSize+"px Verdana",game.textAlign="end",startGame()}function renderLifes(){const e=Array(totalLifes).fill(emojis.HEART);life.innerHTML="",e.forEach(e=>life.innerHTML+=e)}function showTime(){timer.innerHTML=Date.now()-timeStart}function showRecord(){record.innerHTML=recordTime}function renderMapLevel(e){const t=maps[e].trim().split("\n");actualMapLevel=t.map(e=>e.trim().split("")),collisionPositions=[],clearCanvas(),renderLifes(),timeStart||(timeStart=Date.now(),timeInterval=setInterval(showTime,100)),showRecord(),actualMapLevel.forEach((e,t)=>{e.forEach((e,n)=>{const i=emojis[e],o=elementSize*(n+1),a=elementSize*(t+1);"O"==e?playerPosition.x||playerPosition.y||(playerPosition.x=o,playerPosition.y=a):"I"==e?(bonePosition.x=o,bonePosition.y=a):"X"==e&&collisionPositions.push({x:o,y:a}),game.fillText(i,o,a)})}),renderPlayerPosition()}function renderPlayerPosition(){game.fillText(emojis.PLAYER,playerPosition.x,playerPosition.y),validateCollisions(),getTheBone()}function clearCanvas(){game.clearRect(0,0,canvasSize,canvasSize)}function renderMessage(e){game.font=elementSize+"px Cherry Bomb One",game.fontWeight="bold",game.fillStyle="#c27434",game.textAlign="center",game.fillText(e,canvasSize/2,canvasSize/2)}function exit(){modal.classList.remove("active"),modalWinner.classList.remove("active"),modalBlock.classList.add("active")}function moveUp(){playerPosition.y-=elementSize,withinTheMargin()?startGame():playerPosition.y+=elementSize}function moveDown(){playerPosition.y+=elementSize,withinTheMargin()?startGame():playerPosition.y-=elementSize}function moveLeft(){playerPosition.x-=elementSize,withinTheMargin()?startGame():playerPosition.x+=elementSize}function moveRight(){playerPosition.x+=elementSize,withinTheMargin()?startGame():playerPosition.x-=elementSize}function moveByKeys(e){"ArrowUp"==e.key?moveUp():"ArrowDown"==e.key?moveDown():"ArrowLeft"==e.key?moveLeft():"ArrowRight"==e.key&&moveRight()}function validateCollisions(){collisionPositions.find(e=>{const t=e.x.toFixed(3)==playerPosition.x.toFixed(3),n=e.y.toFixed(3)==playerPosition.y.toFixed(3);return t&&n})&&(game.fillText(emojis.BOMB_COLLISION,playerPosition.x,playerPosition.y),totalLifes>0?crashOver():gameOver())}function getTheBone(){JSON.stringify(bonePosition)===JSON.stringify(playerPosition)&&validateLastLevel(level)}function withinTheMargin(){if(playerPosition.x>=elementSize&&playerPosition.x<=canvasSize&&playerPosition.y>=elementSize&&playerPosition.y<=canvasSize)return!0}function validateLastLevel(e){e<maps.length-1?levelUp():winGame()}function crashOver(){loseLife(),playerPosition.x=void 0,playerPosition.y=void 0,setTimeout(startGame,1e3)}function reset(){playerPosition.x=void 0,playerPosition.y=void 0,level=0,totalLifes=["❤️","❤️","❤️"]}function loseLife(){totalLifes--,renderLifes()}function startGame(){renderMapLevel(level)}function gameOver(){clearCanvas(),renderMessage(messages.gameOver),clearInterval(timeInterval),setTimeout(modal.classList.add("active"),1e3)}function levelUp(){level++,clearCanvas(),renderMessage(messages.levelUp),setTimeout(setCanvasSize,1e3)}function winGame(){const e=Date.now()-timeStart;clearInterval(timeInterval);const t=e=>{clearCanvas();for(let e=1;e<=10;e++)for(let t=1;t<=10;t++)game.fillText(emojis.I,elementSize*e,elementSize*t);renderMessage(e),setInterval((function(){(new JSConfetti).addConfetti({emojis:["🦴","🐶","✨","🏆"],confettiRadius:6,confettiNumber:50})}),1e3);const t=modalWinner.classList.add("active");setTimeout(t,5e3)};recordTime?recordTime>=e?(localStorage.setItem("record_time",e),t(messages.newRecord)):t(messages.gameWin):(localStorage.setItem("record_time",e),t(messages.newRecord))}window.addEventListener("load",setCanvasSize),window.addEventListener("resize",setCanvasSize),window.addEventListener("keydown",moveByKeys),btnUp.addEventListener("click",moveUp),btnDown.addEventListener("click",moveDown),btnRight.addEventListener("click",moveRight),btnLeft.addEventListener("click",moveLeft),btnNo.addEventListener("click",exit),btnNoPlay.addEventListener("click",exit),window.onclick=function(e){e.target==modal?(modal.style.display="none",modalBlock.style.display="block"):e.target==modalWinner&&(modalWinner.style.display="none")},console.log(">> Ready :)");const emojis={"-":" ",O:"🏠",X:"🌳",I:"🦴",PLAYER:"🐶",BOMB_COLLISION:"💥",GAME_OVER:"👎",WIN:"🏆",HEART:"❤️"},maps=[];maps.push("\n    IXXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    OXXXXXXXXX\n  "),maps.push("\n    O--XXXXXXX\n    X--XXXXXXX\n    XX----XXXX\n    X--XX-XXXX\n    X-XXX--XXX\n    X-XXXX-XXX\n    XX--XX--XX\n    XX--XXX-XX\n    XXXX---IXX\n    XXXXXXXXXX\n    ");