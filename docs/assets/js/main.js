"use strict";const canvas=document.querySelector(".js-canvas"),game=canvas.getContext("2d"),btnUp=document.querySelector(".item-up"),btnDown=document.querySelector(".item-down"),btnRight=document.querySelector(".item-right"),btnLeft=document.querySelector(".item-left");let actualMapLevel,canvasSize,elementSize,level=0,totalLifes=3;const playerPosition={x:void 0,y:void 0},bonePosition={x:void 0,y:void 0},initialPosition={x:void 0,y:void 0};let collisionPositions=[],isWithinTheMargin=!0;function setCanvasSize(){canvasSize=window.innerHeight>window.innerWidth?Math.floor(.75*window.innerWidth):Math.floor(.75*window.innerHeight),canvas.setAttribute("width",canvasSize),canvas.setAttribute("height",canvasSize),elementSize=Math.floor(canvasSize/10-.4),game.font=elementSize+"px Verdana",game.textAlign="end",startGame()}function renderMapLevel(e){const i=maps[e].trim().split("\n");actualMapLevel=i.map(e=>e.trim().split("")),collisionPositions=[],clearCanvas(),actualMapLevel.forEach((e,i)=>{e.forEach((e,n)=>{const t=emojis[e],o=elementSize*(n+1),a=elementSize*(i+1);"O"==e?playerPosition.x||playerPosition.y||(playerPosition.x=o,playerPosition.y=a,initialPosition.x=o,initialPosition.y=a):"I"==e?(bonePosition.x=o,bonePosition.y=a):"X"==e&&collisionPositions.push({x:o,y:a}),game.fillText(t,o,a)})}),renderPlayerPosition()}function renderPlayerPosition(){game.fillText(emojis.PLAYER,playerPosition.x,playerPosition.y),validateCollisions(),getTheBone()}function moveUp(){playerPosition.y-=elementSize,withinTheMargin()?startGame():playerPosition.y+=elementSize}function moveDown(){playerPosition.y+=elementSize,withinTheMargin()?startGame():playerPosition.y-=elementSize}function moveLeft(){playerPosition.x-=elementSize,withinTheMargin()?startGame():playerPosition.x+=elementSize}function moveRight(){playerPosition.x+=elementSize,withinTheMargin()?startGame():playerPosition.x-=elementSize}function moveByKeys(e){"ArrowUp"==e.key?moveUp():"ArrowDown"==e.key?moveDown():"ArrowLeft"==e.key?moveLeft():"ArrowRight"==e.key&&moveRight()}function validateCollisions(){const e=collisionPositions.find(e=>{const i=e.x.toFixed(3)==playerPosition.x.toFixed(3),n=e.y.toFixed(3)==playerPosition.y.toFixed(3);return i&&n});e&&(totalLifes>1?crashOver():gameOver()),console.log({playerPosition:playerPosition,collision:e,totalLifes:totalLifes})}function getTheBone(){JSON.stringify(bonePosition)===JSON.stringify(playerPosition)&&(console.log("congrats!!"),validateLastLevel(level))}function withinTheMargin(){if(playerPosition.x>=elementSize&&playerPosition.x<=canvasSize&&playerPosition.y>=elementSize&&playerPosition.y<=canvasSize)return!0}function validateLastLevel(e){e<maps.length-1?levelUp():winGame()}function clearCanvas(){game.clearRect(0,0,canvasSize,canvasSize)}function crashOver(){console.log("CRASH!"),loseLife(),playerPosition.x=initialPosition.x,playerPosition.y=initialPosition.y,setTimeout(startGame,1e3)}function gameOver(){console.log("GAME OVER")}function loseLife(){totalLifes--}function startGame(){renderMapLevel(level)}function levelUp(){level++,console.log("well done"),startGame()}function winGame(){console.log("no mas mapas"),clearCanvas();for(let e=1;e<=10;e++)for(let i=1;i<=10;i++)game.fillText(emojis.I,elementSize*e,elementSize*i);(new JSConfetti).addConfetti({emojis:["🦴","🐶","✨","🏆"],confettiRadius:6,confettiNumber:50})}window.addEventListener("load",setCanvasSize),window.addEventListener("resize",setCanvasSize),window.addEventListener("keydown",moveByKeys),btnUp.addEventListener("click",moveUp),btnDown.addEventListener("click",moveDown),btnRight.addEventListener("click",moveRight),btnLeft.addEventListener("click",moveLeft),console.log(">> Ready :)");const emojis={"-":" ",O:"🏠",X:"🌳",I:"🦴",PLAYER:"🐶",BOMB_COLLISION:"🗯️",GAME_OVER:"👎",WIN:"🏆"},maps=[];maps.push("\n    IXXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    -XXXXXXXXX\n    OXXXXXXXXX\n  "),maps.push("\n    O--XXXXXXX\n    X--XXXXXXX\n    XX----XXXX\n    X--XX-XXXX\n    X-XXX--XXX\n    X-XXXX-XXX\n    XX--XX--XX\n    XX--XXX-XX\n    XXXX---IXX\n    XXXXXXXXXX\n    ");